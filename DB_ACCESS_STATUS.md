# –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –î–û–°–¢–£–ü –ï–°–¢–¨!

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: `db_21day`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `gen_user`
- PostgreSQL 18.0

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã:
1. **profiles** - –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - id, user_id, name, email, created_at, updated_at
   
2. **user_roles** - —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - id, user_id, role (admin/student), created_at
   
3. **lesson_content** - –∫–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–æ–≤
   - id, lesson_id, custom_description, video_urls, additional_materials, is_published, ai_prompt, pdf_urls
   
4. **practical_materials** - –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
   - id, title, description, video_url, sort_order, is_published
   
5. **student_progress** - –ø—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
   - id, user_id, lesson_id, completed, quiz_completed, completed_at

### –°—Ö–µ–º—ã:
- `public` - –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `auth` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞–ø—Ä—è–º—É—é)
- `storage` - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: Row Level Security (RLS)

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç:
- `auth.uid()` - ID –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Supabase
- `has_role(auth.uid(), 'admin')` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `gen_user` –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
- –ù—É–∂–Ω–æ –ª–∏–±–æ –æ—Ç–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è backend, –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å service role

## üîß –†–µ—à–µ–Ω–∏—è:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è backend –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
ALTER TABLE public.profiles DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_roles DISABLE ROW LEVEL SECURITY;
-- –∏ —Ç.–¥. –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å service role (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∞–≤–∞–º–∏ –æ–±—Ö–æ–¥–∞ RLS
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π service role

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò–∑–º–µ–Ω–∏—Ç—å backend –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å RLS
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- –•—Ä–∞–Ω–∏—Ç—å user_id –≤ JWT —Ç–æ–∫–µ–Ω–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SECURITY DEFINER —Ñ—É–Ω–∫—Ü–∏–∏

## ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:

- ‚úÖ Backend API –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å RLS –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º

